---
source: crates/postgres/tests/integration/replicas/update_by_id.rs
expression: ctx.queries()
---
[[queries]]
sql = '''
SELECT
  "id",
  "medium_id",
  "display_order",
  "original_url",
  "mime_type",
  "width",
  "height",
  "phase",
  "created_at",
  "updated_at"
FROM
  "replicas"
WHERE
  "id" = $1
FOR UPDATE'''
rows_affected = 1
rows_returned = 1

[[queries]]
sql = '''
UPDATE
  "replicas"
SET
  "updated_at" = CURRENT_TIMESTAMP,
  "mime_type" = $1,
  "width" = $2,
  "height" = $3,
  "phase" = $4
WHERE
  "id" = $5
RETURNING
  "id",
  "medium_id",
  "display_order",
  "original_url",
  "mime_type",
  "width",
  "height",
  "phase",
  "created_at",
  "updated_at"'''
rows_affected = 1
rows_returned = 1

[[queries]]
sql = '''
DELETE FROM
  "thumbnails"
WHERE
  "replica_id" = $1'''
rows_affected = 1
rows_returned = 0

[[queries]]
sql = '''
SELECT
  pg_notify($1, $2)'''
rows_affected = 1
rows_returned = 1

[[queries]]
sql = 'COMMIT'
rows_affected = 0
rows_returned = 0
